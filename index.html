<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movistar Elite | Portal de Portabilidad Avanzada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        movistar: { blue: '#019DF0', dark: '#005A87', green: '#5BC500', slate: '#0f172a' }
                    },
                    animation: { 'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7fa; scroll-behavior: smooth; }
        .step-panel { display: none; }
        .step-panel.active { display: block; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.4); }
        .device-card:hover { transform: translateY(-5px); border-color: #019DF0; box-shadow: 0 20px 25px -5px rgba(1, 157, 240, 0.15); }
        select:focus, input:focus, textarea:focus { outline: none; border-color: #019DF0 !important; box-shadow: 0 0 0 3px rgba(1, 157, 240, 0.2); }
    </style>
</head>
<body class="text-slate-900">

    <nav class="glass sticky top-0 z-50 border-b border-slate-200 py-4 px-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="w-10 h-10 bg-movistar-blue rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-gem text-white"></i>
                </div>
                <h1 class="font-black text-xl italic uppercase tracking-tighter text-slate-800">Movistar <span class="text-movistar-blue">Elite</span></h1>
            </div>
            <div id="progress-bar" class="hidden md:flex gap-1.5">
                <div class="w-10 h-2 rounded-full bg-movistar-blue transition-all" id="dot-1"></div>
                <div class="w-10 h-2 rounded-full bg-slate-200 transition-all" id="dot-2"></div>
                <div class="w-10 h-2 rounded-full bg-slate-200 transition-all" id="dot-3"></div>
                <div class="w-10 h-2 rounded-full bg-slate-200 transition-all" id="dot-4"></div>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto py-8 px-4">

        <section id="step-1" class="step-panel active">
            <div class="text-center mb-10">
                <span class="bg-blue-50 text-movistar-blue text-[10px] font-black px-4 py-2 rounded-full uppercase tracking-widest">Paso 01: Catálogo Exclusivo</span>
                <h2 class="text-4xl font-black italic uppercase mt-4 text-slate-800">Elige tu <span class="text-movistar-blue">Equipo</span></h2>
                <p class="text-slate-500 font-medium mt-2">Selecciona el smartphone que deseas adquirir con tu portabilidad.</p>
            </div>
            <div id="catalog-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="step-2" class="step-panel">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                <div class="lg:col-span-5 glass rounded-[2.5rem] p-8 text-center shadow-2xl border-b-8 border-movistar-blue">
                    <img id="prev-img" src="" class="h-64 mx-auto object-contain mb-6 drop-shadow-2xl">
                    <h3 id="prev-name" class="text-3xl font-black uppercase italic text-slate-800 leading-tight"></h3>
                    <p id="prev-brand" class="text-movistar-blue font-black tracking-widest text-xs mt-2 mb-6"></p>
                    <div class="bg-slate-50 rounded-2xl p-6 space-y-3 border border-slate-200 text-left">
                        <div class="flex justify-between font-bold text-slate-400 text-sm"><span>Costo Equipo</span><span id="p-base"></span></div>
                        <div class="flex justify-between font-bold text-movistar-green text-sm"><span>Promoción</span><span id="p-promo"></span></div>
                        <div class="flex justify-between font-black text-slate-900 text-xl border-t border-slate-200 pt-3"><span>Pago Inicial</span><span id="p-total" class="text-movistar-blue"></span></div>
                        <div id="box-mes" class="bg-blue-50 p-3 rounded-xl border border-blue-100 hidden mt-4">
                            <p class="text-[10px] font-black text-movistar-blue uppercase">Mensualidad Estimada</p>
                            <p id="p-mes" class="text-2xl font-black text-movistar-blue"></p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 bg-white rounded-[2.5rem] p-8 md:p-10 shadow-2xl">
                    <h4 class="text-sm font-black uppercase text-movistar-blue mb-4"><i class="fas fa-star mr-2"></i> 1. Elige tu Promoción</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <label class="cursor-pointer group">
                            <input type="radio" name="promo" value="100" class="hidden peer" checked onchange="App.calc()">
                            <div class="p-5 rounded-2xl border-2 border-slate-100 peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">
                                <div class="flex justify-between"><span class="font-black text-lg">Elite Ilimitado</span><span class="font-black text-movistar-blue">$100</span></div>
                                <p class="text-xs text-slate-500 font-bold mt-1"><i class="fas fa-bolt text-yellow-400"></i> Vigencia 45 Días | Todo Ilimitado</p>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="promo" value="50" class="hidden peer" onchange="App.calc()">
                            <div class="p-5 rounded-2xl border-2 border-slate-100 peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">
                                <div class="flex justify-between"><span class="font-black text-lg">Básico Redes</span><span class="font-black text-movistar-blue">$50</span></div>
                                <p class="text-xs text-slate-500 font-bold mt-1"><i class="fas fa-wifi text-movistar-green"></i> Vigencia 30 Días | RRSS Libres</p>
                            </div>
                        </label>
                    </div>

                    <h4 class="text-sm font-black uppercase text-movistar-blue mb-4"><i class="fas fa-calendar-alt mr-2"></i> 2. Plazo de Financiamiento</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-10">
                        <label class="cursor-pointer"><input type="radio" name="plazo" value="1" class="hidden peer" checked onchange="App.calc()"><div class="p-4 rounded-xl border-2 border-slate-100 text-center font-black peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">Contado</div></label>
                        <label class="cursor-pointer"><input type="radio" name="plazo" value="6" class="hidden peer" onchange="App.calc()"><div class="p-4 rounded-xl border-2 border-slate-100 text-center font-black peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">6 Meses</div></label>
                        <label class="cursor-pointer"><input type="radio" name="plazo" value="12" class="hidden peer" onchange="App.calc()"><div class="p-4 rounded-xl border-2 border-slate-100 text-center font-black peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">12 Meses</div></label>
                        <label class="cursor-pointer"><input type="radio" name="plazo" value="24" class="hidden peer" onchange="App.calc()"><div class="p-4 rounded-xl border-2 border-slate-100 text-center font-black peer-checked:border-movistar-blue peer-checked:bg-blue-50 transition-all">24 Meses</div></label>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="App.goTo(1)" class="flex-1 py-5 rounded-2xl font-black text-slate-500 border-2 border-slate-200 hover:bg-slate-50 uppercase">Regresar</button>
                        <button onclick="App.goTo(3)" class="flex-[2] bg-movistar-blue text-white py-5 rounded-2xl font-black text-lg shadow-xl shadow-blue-500/30 hover:bg-movistar-dark uppercase italic">Validar Identidad <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <section id="step-3" class="step-panel">
            <div class="max-w-2xl mx-auto glass rounded-[3rem] p-10 shadow-2xl">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-black uppercase italic">Identidad Oficial</h2>
                    <p class="text-slate-500 font-medium">Requerimos tus datos exactos para calcular tu CURP y aprobar la línea.</p>
                </div>
                <form id="form-data" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="md:col-span-2">
                        <input type="text" id="d-nom" required placeholder="Nombre(s)" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold uppercase">
                    </div>
                    <input type="text" id="d-pat" required placeholder="Apellido Paterno" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold uppercase">
                    <input type="text" id="d-mat" required placeholder="Apellido Materno" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold uppercase">
                    <input type="date" id="d-fec" required class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold text-slate-600">
                    <select id="d-est" required class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold text-slate-600">
                        <option value="">Estado Nacimiento...</option>
                        <option value="AS">Aguascalientes</option><option value="BC">Baja California</option><option value="BS">Baja California Sur</option>
                        <option value="CC">Campeche</option><option value="CH">Chihuahua</option><option value="CL">Coahuila</option><option value="CM">Colima</option>
                        <option value="CS">Chiapas</option><option value="DF">Ciudad de México</option><option value="DG">Durango</option><option value="GT">Guanajuato</option>
                        <option value="GR">Guerrero</option><option value="HG">Hidalgo</option><option value="JC">Jalisco</option><option value="MC">México</option>
                        <option value="MN">Michoacán</option><option value="MS">Morelos</option><option value="NT">Nayarit</option><option value="NL">Nuevo León</option>
                        <option value="OC">Oaxaca</option><option value="PL">Puebla</option><option value="QT">Querétaro</option><option value="QR">Quintana Roo</option>
                        <option value="SP">San Luis Potosí</option><option value="SL">Sinaloa</option><option value="SR">Sonora</option><option value="TC">Tabasco</option>
                        <option value="TS">Tamaulipas</option><option value="TL">Tlaxcala</option><option value="VZ">Veracruz</option><option value="YN">Yucatán</option><option value="ZS">Zacatecas</option>
                    </select>
                    <div class="md:col-span-2 flex gap-4">
                        <label class="flex-1 cursor-pointer"><input type="radio" name="d-sex" value="H" class="hidden peer" required><div class="p-4 rounded-xl border-2 border-slate-200 text-center font-bold peer-checked:border-slate-800 peer-checked:bg-slate-800 peer-checked:text-white transition-all">Hombre</div></label>
                        <label class="flex-1 cursor-pointer"><input type="radio" name="d-sex" value="M" class="hidden peer"><div class="p-4 rounded-xl border-2 border-slate-200 text-center font-bold peer-checked:border-slate-800 peer-checked:bg-slate-800 peer-checked:text-white transition-all">Mujer</div></label>
                    </div>
                    <button type="submit" class="md:col-span-2 bg-movistar-green text-white py-6 rounded-2xl font-black text-xl italic uppercase shadow-xl hover:bg-green-600 transition-all">
                        Calcular CURP y Continuar <i class="fas fa-id-card ml-2"></i>
                    </button>
                </form>
            </div>
        </section>

        <section id="step-4" class="step-panel">
            <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-[3rem] p-10 shadow-2xl border-2 border-transparent hover:border-movistar-blue transition-all">
                    <h3 class="text-2xl font-black uppercase italic mb-6">Entrega y Cierre</h3>
                    <form id="form-final" class="space-y-5">
                        <select id="l-metodo" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold" onchange="App.toggleLogistics()">
                            <option value="SUCURSAL">Retiro en Sucursal Movistar (Recomendado)</option>
                            <option value="DOMICILIO">Envío a Domicilio Express</option>
                        </select>
                        
                        <div id="box-suc" class="space-y-3">
                            <select id="l-estado" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold" onchange="App.loadStores()"></select>
                            <select id="l-tienda" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold">
                                <option value="">Selecciona Sucursal...</option>
                            </select>
                        </div>

                        <div id="box-dom" class="hidden">
                            <textarea id="l-dir" placeholder="Dirección, CP y Referencias..." class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold resize-none" rows="3"></textarea>
                        </div>

                        <input type="tel" id="l-tel" required placeholder="Línea actual a portar (10 dígitos)" maxlength="10" class="w-full p-4 rounded-xl border-2 border-slate-200 bg-slate-50 font-bold">
                        
                        <button type="submit" class="w-full bg-movistar-blue text-white py-6 rounded-2xl font-black text-xl italic uppercase shadow-xl hover:bg-movistar-dark transition-all mt-4">
                            ENVIAR ORDEN A ASESOR <i class="fab fa-whatsapp ml-2"></i>
                        </button>
                    </form>
                </div>

                <div class="bg-slate-900 rounded-[3rem] p-10 shadow-2xl text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-movistar-green opacity-20 rounded-bl-full"></div>
                    <h3 class="text-2xl font-black uppercase italic mb-6">Tu Resumen Elite</h3>
                    <div class="space-y-4 text-sm font-medium">
                        <div class="flex justify-between border-b border-white/10 pb-3">
                            <span class="text-slate-400">Identidad Validada:</span>
                            <span id="res-curp" class="font-mono font-bold text-movistar-green animate-pulse-fast"></span>
                        </div>
                        <div class="flex justify-between border-b border-white/10 pb-3">
                            <span class="text-slate-400">Titular:</span>
                            <span id="res-nom" class="uppercase font-bold"></span>
                        </div>
                        <div class="flex justify-between border-b border-white/10 pb-3">
                            <span class="text-slate-400">Equipo:</span>
                            <span id="res-eq" class="font-bold"></span>
                        </div>
                        <div class="flex justify-between border-b border-white/10 pb-3">
                            <span class="text-slate-400">Promoción:</span>
                            <span id="res-promo" class="font-bold text-movistar-blue"></span>
                        </div>
                        <div class="flex justify-between pb-3">
                            <span class="text-slate-400">Plazo:</span>
                            <span id="res-plazo" class="font-bold"></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // DIRECTORIO OFICIAL DE SUCURSALES (Extraído del PDF proporcionado)
        const STORES_DATA = {
            "AGUASCALIENTES": ["MOVISTAR PLAZA VELARIA MALL", "MOVISTAR PLAZA VILLA ASUNCION", "MOVISTAR BOSQUES AGUASCALIENTES", "MOVISTAR GUADALUPE AGUASCALIENTES", "MOVISTAR PARQUE HIDALGO AGS", "MOVISTAR CENTRO AGUASCALIENTES"],
            "BAJA CALIFORNIA": ["MOVISTAR PACIFICO TUUANA", "MOVISTAR MEXICALI", "MOVISTAR MACROPLAZA DOS TIJUANA", "MOVISTAR PASEO TUUANA 2000", "MOVISTAR PASEO DE LOS HEROES TIJUANA", "MOVISTAR PLAZA NUEVO MEXICALI", "MOVISTAR ALAMEDA OTAY", "MOVISTAR CENTRO ENSENADA", "MOVISTAR LOMA BONITA", "MOVISTAR JUSTO SIERRA MEXICALI", "MOVISTAR CENTRO TIJUANA", "MOVISTAR COSTERO ENSENADA", "MOVISTAR PABELLON ROSARITO", "MOVISTAR PLAZA LAS BRISAS", "MOVISTAR SENDERO TUUANA", "MOVISTAR MACROPLAZA TUUANA", "MOVISTAR GALERIAS DEL VALLE", "MOVISTAR MONARCAS MEXICALI", "MOVISTAR PLAZA LA PAJARITA"],
            "BAJA CALIFORNIA SUR": ["MOVISTAR LA PAZ", "MOVISTAR CABO SAN LUCAS"],
            "CAMPECHE": ["MOVISTAR CD. DEL CARMEN", "MOVISTAR GALERIAS CAMPECHE", "MOVISTAR CAMPECHE"],
            "CIUDAD DE MÉXICO": ["MOVISTAR GALERIAS DE LAS ESTRELLAS", "MOVISTAR PORTAL CENTENARIO", "MOVISTAR AEROPUERTO CDMX", "MOVISTAR CALZADA DE LAS AGUILAS", "MOVISTAR PORTAL LOMAS ESTRELLA", "MOVISTAR CALLE REPUBLICA DE URUGUAY", "MOVISTAR PASEO ACOXΡΑ", "MOVISTAR GALERIAS INSURGENTES", "MOVISTAR TOWN CENTER ROSARIO", "MOVISTAR CUAJIMALPA CENTRO", "MOVISTAR INSURGENTES SUR", "MOVISTAR REFORMA 222", "MOVISTAR GRAN SUR", "MOVISTAR CC SANTA FE", "MOVISTAR CENTRO HISTORICO CDMX", "MOVISTAR PLAZA TEPEYAC", "MOVISTAR PUERTA ARAGON", "MOVISTAR PARQUE TEZONTLE", "MOVISTAR FORUM BUENAVISTA", "MOVISTAR PARQUE LAS ANTENAS", "MOVISTAR ZENTRALIA CHURUBUSCO", "MOVISTAR OASIS COYOACAN", "MOVISTAR PARQUE LINDAVISTA", "MOVISTAR PARQUE DELTA", "MOVISTAR PABELLON DEL VALLE", "MOVISTAR PORTAL SAN ANGEL", "MOVISTAR PORTAL CENTRO", "MOVISTAR PATIO REVOLUCION", "MOVISTAR PLAZA TLATELOLCO", "MOVISTAR PLAZA LINDAVISTA", "MOVISTAR PARQUE VIA VALLEJO", "MOVISTAR PABELLON ALTAVISTA", "MOVISTAR PORTAL CHURUBUSCO"],
            "CHIAPAS": ["MOVISTAR TUXTLA GUTIERREZ", "MOVISTAR TAPACHULA"],
            "CHIHUAHUA": ["MOVISTAR CENTRO BENITO JUAREZ", "MOVISTAR PLAZA SENDERO JUAREZ", "MOVISTAR PLAZA SAN AGUSTIN", "MOVISTAR PLAZA SENDERO LAS TORRES", "MOVISTAR CUAUHTEMOC", "MOVISTAR INDEPENDENCIA CHIHUAHUA", "MOVISTAR PLAZA VALLARTA", "MOVISTAR PLAZA SENDERO CHIHUAHUA", "MOVISTAR GRAN PATIO ZARAGOZA", "MOVISTAR GALERIAS TEC CD JUAREZ", "MOVISTAR FASHION MALL CHIHUAHUA", "MOVISTAR PLAZA LAS MISIONES JUAREZ", "MOVISTAR NUEVA ESPAÑA CHIHUAHUA", "MOVISTAR DELICIAS"],
            "COAHUILA": ["MOVISTAR TORREON CENTRO", "MOVISTAR CALZADA COLON TORREON", "MOVISTAR MONCLOVA", "MOVISTAR PLAZA SENDERO SUR SALTILLO", "MOVISTAR HEB REVOLUCION", "MOVISTAR INDEPENDENCIA TORREON", "MOVISTAR PLAZA NOGALERA SALTILLO II", "MOVISTAR PATIO SALTILLO", "MOVISTAR VENUSTIANO CARRANZA SALTILLE", "MOVISTAR PIEDRAS NEGRAS"],
            "COLIMA": ["MOVISTAR PLAZA MANZANILLO", "MOVISTAR COLIMA"],
            "DURANGO": ["MOVISTAR DURANGO", "MOVISTAR DURANGO CENTRO"],
            "ESTADO DE MÉXICO": ["MOVISTAR PLAZA CAÑADA HUEHUETOCA", "MOVISTAR MARIANO MATAMORDS TOLUCA", "MOVISTAR MIGUEL HIDALGO TOLUCA", "MOVISTAR TOWN CENTER ZUMPANGO", "MOVISTAR PATIO TOLUCA", "MOVISTAR PLAZA ARKANA NORTE", "MOVISTAR PLAZA ESTRELLA ATLACOMULCO", "MOVISTAR COACALCO", "MOVISTAR METEPEC PLAZA SAN JUAN", "MOVISTAR LUNA PARK", "MOVISTAR OUTLET LERMA", "MOVISTAR PLAZA MIA ZINACANTEPEC", "MOVISTAR TECAMAC POWER CENTER", "MOVISTAR SENDERO TOLUCA", "MOVISTAR CENTRO SAN MIGUEL CUAUTITLA", "MOVISTAR PLAZA SAN MARCOS", "MOVISTAR PLAZA LAS AMERICAS", "MOVISTAR PLAZA COACALCO", "MOVISTAR PATIO ECATEPEC", "MOVISTAR PLAZA COSMOPOL", "MOVISTAR PARQUE TOREO", "MOVISTAR PLAZA CRYSTAL ATIZAPAN", "MOVISTAR PLAZA SATELITE", "MOVISTAR PLAZA ARAGON", "MOVISTAR NEZAHUALCOYOTL", "MOVISTAR PASEO INTERLOMAS", "MOVISTAR TWON CENTER NICOLAS ROMERO", "MOVISTAR CENTRO CHALCO", "MOVISTAR PLAZA CENTRO TΕΡΟΖΑΝ", "MOVISTAR SATELITE", "MOVISTAR TLALNEPANTLA CENTRO", "MOVISTAR MUNDO E", "MOVISTAR GALERIAS ATIZAPAN", "MOVISTAR PUERTA TEXCOCO", "MOVISTAR LAS TIENDAS DE SAN ESTEBAN", "MOVISTAR LA CUSPIDE", "MOVISTAR PATIO VALLE DE CHALCO"],
            "GUANAJUATO": ["MOVISTAR LEON CENTRO", "MOVISTAR LOPEZ MATEOS LEON", "MOVISTAR BENITO JUAREZ CELAYA CENTRO", "MOVISTAR GALERIAS LAS TORRES", "MOVISTAR IRAPUATO CENTRO", "MOVISTAR PLAZA CIBELES", "MOVISTAR PLAZA OBELISCO", "MOVISTAR SALAMANCA", "MOVISTAR SAN JUAN BOSCO LEON", "MOVISTAR PABELLON CELAYA", "MOVISTAR CERRO GORDO LEON", "MOVISTAR MARIANO ESCOBEDO LEON"],
            "GUERRERO": ["MOVISTAR COSTERA ACAPULCO"],
            "HIDALGO": ["MOVISTAR PLAZA EXPLANADA PACHUCA", "MOVISTAR PATIO PACHUCA", "MOVISTAR GALERIAS PACHUCA", "MOVISTAR PATIO TULANCINGO", "MOVISTAR PLAZA UNIVERSIDAD PACHUCA"],
            "JALISCO": ["MOVISTAR PLAZA LOMAS RID NILO", "MOVISTAR PLAZA REAL CENTER", "MOVISTAR PLAZA REGINA", "MOVISTAR LA UNE PLAZA DEL SOL", "MOVISTAR PLAZA GRAN TERRAZA BELENES", "MOVISTAR GALERIAS GUADALAJARA", "MOVISTAR GALERIAS VALLARTA", "MOVISTAR PLAZA LAS TORRES", "MOVISTAR PLAZA PUNTO SAN ISIDRO", "MOVISTAR PLAZA LA PERLA ZAPOPAN", "MOVISTAR TONALA CENTRO", "MOVISTAR MERCADO CORONA GDL", "MOVISTAR PLAZA GRAN TERRAZA OBLATOS", "MOVISTAR PUERTO VALLARTA", "MOVISTAR PLAZA DEL SOL", "MOVISTAR SAN JUAN BOSCO GUADALAJARA", "MOVISTAR PLAZA PATRIA ZAPOPAN", "MOVISTAR REVOLUCION GUADALAJARA", "MOVISTAR GUADALAJARA CENTRO HISTORIC", "MOVISTAR NUEVO VALLARTA", "MOVISTAR TRANSITO GUADALAJARA", "MOVISTAR CHAPULTEPEC", "MOVISTAR ESTADIO JALISCO", "MOVISTAR PLAZA CENTRO SUR"],
            "MICHOACAN": ["MOVISTAR WALMART ESTADIO MORELIA", "MOVISTAR MERCADO INDEPENDENCIA MOR", "MOVISTAR URUAPAN", "MOVISTAR TABACHINES", "MOVISTAR LA HUERTA MORELIA"],
            "MORELOS": ["MOVISTAR WALMART JIUTEРЕС", "MOVISTAR CUERNAVACA PALMAS", "MOVISTAR PLAZA ATRIOS CUAUTLA", "MOVISTAR DOMINGO DIEZ", "MOVISTAR CUAUTLA CENTRO"],
            "NAYARIT": ["MOVISTAR TEPIC"],
            "NUEVO LEON": ["MOVISTAR PLAZA CENTRIKA MTY", "MOVISTAR NUEVO SUR", "MOVISTAR MULTIPLAZA LINDAVISTA", "MOVISTAR PASEO SANTA CATARINA", "MOVISTAR PLAZA REAL", "MOVISTAR ALTEA LINCOLN MONTERREY", "MOVISTAR PLAZA CUMBRES", "MOVISTAR PLAZOLETA GARCIA", "MOVISTAR ALAMEDA MONTERREY", "MOVISTAR PUNTO PONIENTE MONTERREY", "MOVISTAR PLAZA SENDERO APODACA", "MOVISTAR SANTO DOMINGO", "MOVISTAR SENDERO LA FE APODACA", "MOVISTAR RAUL SALINAS MONTERREY", "MOVISTAR PLAZA FIESTA ANAHUAC", "MOVISTAR GALERIAS MONTERREY", "MOVISTAR CENTRO APODACA", "MOVISTAR SUNMALL GUADALUPE", "MOVISTAR CENTRO CADEREYTA", "MOVISTAR PLAZA CITADEL", "MOVISTAR SUN MALL JUAREZ", "MOVISTAR MORELOS MONTERREY", "MOVISTAR PLAZA FIESTA SAN AGUSTIN"],
            "OAXACA": ["MOVISTAR OAXACA"],
            "PUEBLA": ["MOVISTAR PLAZA PARQUE PUEBLA", "MOVISTAR PUEBLA PABELLON DORADA", "MOVISTAR BOULEVARD NORTE", "MOVISTAR AV JUAREZ PUEBLA", "MOVISTAR PLAZA EL PASEO TEHUACAN", "MOVISTAR EXPLANADA PUEBLA", "MOVISTAR PLAZA SAN SEBASTIAN", "MOVISTAR GALERIAS HERMANOS SERDAN", "MOVISTAR 2 PONIENTE CENTRO", "MOVISTAR HIPER SORIANA CAPU", "MOVISTAR PLAZA LAS MARGARITAS", "MOVISTAR SAN ANDRES CHOLULA", "MOVISTAR PERIPLAZA", "MOVISTAR VIA SAN ANGEL PUEBLA"],
            "QUERETARO": ["MOVISTAR CENTRO QUERETARO", "MOVISTAR PLAZA CONSTITUYENTES QUERETA", "MOVISTAR PLAZA PATIO QUERETARO", "MOVISTAR PLAZA REVOLUCION QRO", "MOVISTAR ANTEA QUERETARO", "MOVISTAR QUERETARO", "MOVISTAR UNIVERSIDAD QUERETARO"],
            "QUINTANA ROO": ["MOVISTAR PLAYA DEL CARMEN", "MOVISTAR MULTIPLAZA KABAH", "MOVISTAR CHETUMAL AV JUAREZ", "MOVISTAR PLAZA LAS AMERICAS CANCUN", "MOVISTAR LA GRAN PLAZA CANCUN", "MOVISTAR CANCUN AV XCARET"],
            "SAN LUIS POTOSI": ["MOVISTAR PLAZA CONSTITUCION SLP", "MOVISTAR PLAZA DEL CARMEN", "MOVISTAR PLAZA SENDERO SAN LUIS POTOS", "MOVISTAR CENTRO SAN LUIS POTOSI", "MOVISTAR CARRETERA 57", "MOVISTAR CENTRO JUAN SARABIA SLP", "MOVISTAR CARRANZA SAN LUIS POTOSI"],
            "SINALOA": ["MOVISTAR MAZATLAN", "MOVISTAR CULIACAN", "MOVISTAR LOS MOCHIS", "MOVISTAR OBREGON CULIACAN", "MOVISTAR GUASAVE", "MOVISTAR EXPLANADA CULIACAN", "MOVISTAR INSURGENTES CULIACAN", "MOVISTAR PASEO SAN ISIDRO CULIACAN", "MOVISTAR PASEOS LOS MOCHIS"],
            "SONORA": ["MOVISTAR PLAZA QUIROGA HERMOSILLO", "PLAZA MOVISTAR CITY CENTER PITIC", "MOVISTAR NAVOJOA", "MOVISTAR OBREGON", "MOVISTAR GUAYMAS", "MOVISTAR SENDERO HERMOSILLO", "MOVISTAR NOGALES", "MOVISTAR KINO SAN LUIS", "MOVISTAR PLAZA HERRADURA", "MOVISTAR PLAZA GIRASOL", "MOVISTAR SUN MALL HERMOSILLO"],
            "TABASCO": ["MOVISTAR PARQUE JUAREZ", "MOVISTAR ALDAMA ZONA LUZ", "MOVISTAR CARDENAS", "MOVISTAR VENDOME", "MOVISTAR COMALCALCO", "MOVISTAR FRANCISCO JAVIER MINA"],
            "TAMAULIPAS": ["MOVISTAR REYNOSA PERIFERICO", "MOVISTAR NUEVO LAREDO", "MOVISTAR MATAMOROS", "MOVISTAR PLAZA PALMAS TAMPICO", "MOVISTAR TAMPICO EJERCITO", "MOVISTAR CIUDAD VICTORIA", "MOVISTAR REYNOSA MORELOS"],
            "TLAXCALA": ["MOVISTAR PLAZA DIAMANTE", "MOVISTAR PLAZA INN TLAXCALA"],
            "VERACRUZ": ["MOVISTAR COATZACOALCOS", "MOVISTAR XALAPA MURILLO VIDAL", "MOVISTAR VERACRUZ RUIZ CORTINEZ", "MOVISTAR PLAZA VALLE ORIZABA", "MOVISTAR VERACRUZ CENTRO", "MOVISTAR POZA RICA", "MOVISTAR CORDOBA"],
            "YUCATAN": ["MOVISTAR MACROPLAZA MERIDA", "MOVISTAR GRAN PLAZA MERIDA", "MOVISTAR MERIDA 56 CENTRO", "MOVISTAR PLAZA DORADA", "MOVISTAR MERIDA MONTEJO", "MOVISTAR KUKULKAN MERIDA", "MOVISTAR GALERIAS MERIDA"],
            "ZACATECAS": ["MOVISTAR ZACATECAS CENTRO", "MOVISTAR FRESNILLO"]
        };

        const CATALOG = [
            { id: 1, name: "iPhone 17 Pro Max", brand: "Apple", price: 5499, img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/IPHONE/iPhone%2017%20Pro%20Max.jfif" },
            { id: 2, name: "Galaxy S24 Ultra", brand: "Samsung", price: 4999, img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/SAMGMUG/s%2024%20ultra.jfif" },
            { id: 3, name: "ZTE Nubia Neo 3 GT", brand: "ZTE", price: 1899, img: "https://placehold.co/400x400/0f172a/019DF0/png?text=Nubia+Neo+3+GT" },
            { id: 4, name: "Xiaomi 13T Pro", brand: "Xiaomi", price: 2899, img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/XIAOMI/Xiaomi%2013T%20Pro.jfif" },
            { id: 5, name: "Motorola Edge 40 Pro", brand: "Motorola", price: 2599, img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/MOTOROLA/Edge%2040%20Pro.jfif" },
            { id: 6, name: "Galaxy Z Fold 5", brand: "Samsung", price: 6200, img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/SAMGMUG/Galaxy%20Z%20Fold%205.jfif" }
        ];

        const App = {
            state: { curp: '', user: {}, selected: null, markup: 1.15, wa: '584124676073' },
            fmt: new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }),

            init() {
                this.renderCatalog();
                document.getElementById('form-data').onsubmit = (e) => { e.preventDefault(); this.processCURP(); };
                document.getElementById('form-final').onsubmit = (e) => { e.preventDefault(); this.finish(); };
                
                // Cargar Directorio de Estados
                const estSel = document.getElementById('l-estado');
                estSel.innerHTML = '<option value="">Selecciona tu Estado...</option>';
                Object.keys(STORES_DATA).sort().forEach(e => estSel.innerHTML += `<option value="${e}">${e}</option>`);
            },

            renderCatalog() {
                const grid = document.getElementById('catalog-grid');
                grid.innerHTML = CATALOG.map(d => `
                    <div onclick="App.selectDevice(${d.id})" class="device-card bg-white p-6 rounded-[2.5rem] border-2 border-slate-100 shadow-xl cursor-pointer transition-all">
                        <img src="${d.img}" class="h-44 mx-auto object-contain mb-4">
                        <p class="text-[9px] font-black text-movistar-blue tracking-widest uppercase">${d.brand}</p>
                        <h4 class="font-black text-slate-800 italic uppercase">${d.name}</h4>
                        <div class="flex justify-between items-end mt-2">
                            <p class="text-xl font-black">${this.fmt.format(Math.round(d.price * this.state.markup))}</p>
                            <div class="bg-slate-100 w-8 h-8 rounded-full flex items-center justify-center text-slate-400"><i class="fas fa-plus"></i></div>
                        </div>
                    </div>
                `).join('');
            },

            selectDevice(id) {
                this.state.selected = CATALOG.find(x => x.id === id);
                document.getElementById('prev-img').src = this.state.selected.img;
                document.getElementById('prev-name').innerText = this.state.selected.name;
                document.getElementById('prev-brand').innerText = this.state.selected.brand;
                this.calc();
                this.goTo(2);
            },

            calc() {
                const d = this.state.selected;
                const promoVal = parseInt(document.querySelector('input[name="promo"]:checked').value);
                const plazo = parseInt(document.querySelector('input[name="plazo"]:checked').value);
                
                const equipoFinal = Math.round(d.price * this.state.markup);
                const totalInicial = equipoFinal + promoVal;

                document.getElementById('p-base').innerText = this.fmt.format(equipoFinal);
                document.getElementById('p-promo').innerText = this.fmt.format(promoVal);
                document.getElementById('p-total').innerText = this.fmt.format(totalInicial);
                
                const boxMes = document.getElementById('box-mes');
                if(plazo > 1) {
                    boxMes.classList.remove('hidden');
                    document.getElementById('p-mes').innerText = this.fmt.format(Math.round(equipoFinal / plazo));
                } else {
                    boxMes.classList.add('hidden');
                }
            },

            processCURP() {
                const n = document.getElementById('d-nom').value.toUpperCase().trim();
                const p = document.getElementById('d-pat').value.toUpperCase().trim();
                const m = document.getElementById('d-mat').value.toUpperCase().trim();
                const f = document.getElementById('d-fec').value;
                const e = document.getElementById('d-est').value;
                const s = document.querySelector('input[name="d-sex"]:checked').value;

                const gV = (x) => x.substring(1).match(/[AEIOU]/)?.[0] || 'X';
                const gC = (x) => x.substring(1).match(/[BCDFGHJKLMNPQRSTVWXYZ]/)?.[0] || 'X';

                this.state.curp = p[0] + gV(p) + m[0] + n[0] + f.substring(2,4) + f.substring(5,7) + f.substring(8,10) + s + e + gC(p) + gC(m) + gC(n) + "A1";
                this.state.user = { nombre: `${n} ${p} ${m}` };
                
                // Actualizar UI del Resumen
                document.getElementById('res-curp').innerText = this.state.curp;
                document.getElementById('res-nom').innerText = this.state.user.nombre;
                document.getElementById('res-eq').innerText = this.state.selected.name;
                document.getElementById('res-promo').innerText = "$" + document.querySelector('input[name="promo"]:checked').value;
                document.getElementById('res-plazo').innerText = document.querySelector('input[name="plazo"]:checked').value + " Meses";
                
                this.goTo(4);
            },

            toggleLogistics() {
                const m = document.getElementById('l-metodo').value;
                document.getElementById('box-suc').classList.toggle('hidden', m !== 'SUCURSAL');
                document.getElementById('box-dom').classList.toggle('hidden', m !== 'DOMICILIO');
            },

            loadStores() {
                const e = document.getElementById('l-estado').value;
                const s = document.getElementById('l-tienda');
                s.innerHTML = '<option value="">Selecciona tu Centro Movistar...</option>';
                if(STORES_DATA[e]) STORES_DATA[e].forEach(t => s.innerHTML += `<option value="${t}">${t}</option>`);
            },

            goTo(n) {
                document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(`step-${n}`).classList.add('active');
                document.querySelectorAll('#progress-bar div').forEach((d, i) => {
                    d.classList.toggle('bg-movistar-blue', i < n);
                    d.classList.toggle('bg-slate-200', i >= n);
                });
                window.scrollTo({top: 0, behavior: 'smooth'});
            },

            finish() {
                const met = document.getElementById('l-metodo').value;
                const loc = met === 'SUCURSAL' ? `${document.getElementById('l-tienda').value}, ${document.getElementById('l-estado').value}` : document.getElementById('l-dir').value;
                
                const promo = document.querySelector('input[name="promo"]:checked').value;
                const plazo = document.querySelector('input[name="plazo"]:checked').value;
                const precioTotal = Math.round(this.state.selected.price * this.state.markup) + parseInt(promo);

                const msg = `*PORTABILIDAD MOVISTAR ELITE*%0A` +
                            `--------------------------------%0A` +
                            `*ID CURP:* ${this.state.curp}%0A` +
                            `*Titular:* ${this.state.user.nombre}%0A` +
                            `*Línea a Portar:* ${document.getElementById('l-tel').value}%0A` +
                            `--------------------------------%0A` +
                            `*Equipo:* ${this.state.selected.name}%0A` +
                            `*Promoción:* $${promo} MXN%0A` +
                            `*Plazo:* ${plazo === '1' ? 'Contado' : plazo + ' Meses'}%0A` +
                            `*Total Inicial:* ${this.fmt.format(precioTotal)}%0A` +
                            `--------------------------------%0A` +
                            `*Método:* ${met}%0A` +
                            `*Ubicación:* ${loc}%0A` +
                            `--------------------------------%0A` +
                            `_Favor de iniciar trámite logístico._`;
                
                window.open(`https://api.whatsapp.com/send?phone=${this.state.wa}&text=${msg}`, '_blank');
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
